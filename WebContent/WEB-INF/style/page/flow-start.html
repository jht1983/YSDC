<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" style="height:100%">
	<script type='text/javascript' src='js/evenfunction.js'></script>
	<script type='text/javascript' src='js/ylselect.js'></script>
	<script type='text/javascript' src='js/yltree.js'></script>
	<script type='text/javascript' src='js/check.js'></script>
	<script>
		gs_root = '/sip';
		
		var locat = window.location.pathname;
 
    if(locat.indexOf("/sip")==-1){
      
        gs_root="";
     
    }
	</script>
		

    <style>
         .noneTable{
            background: url("res/images/none.png");
            background-size: 100% 100%;
            width:100%;height:20px;cursor: pointer;
        }
        .blackTable{
            background: url("res/images/black.png");
            background-size: 100% 100%;
            width:100%;height:20px;cursor: pointer;
        }
        .tableCol td{
            border-top: 1px solid #e9e9e9;border-left: 1px solid #e9e9e9;
            text-align: center;
            text-overflow: ellipsis; /* for IE */  
            -moz-text-overflow: ellipsis; /* for Firefox,mozilla */  
            overflow: hidden;  
            white-space: nowrap;  
        }
        .none{
				/* display: none; */
			}
				.noneSpan {
				border: 0.1px solid aliceblue;
				text-align: center;
		
				display: -moz-inline-box;
				box-sizing: border-box;
				display: inline-block;
				cursor: pointer;
			}
			
			.blockSpan {
				border: 0.1px solid aliceblue;
			
				text-align: center;
			
				display: -moz-inline-box;
				box-sizing: border-box;
				display: inline-block;
				cursor: pointer;
				background-color: #539ddd;
			}
			input[type=checkbox] {
            	width:20px;
            	height:20px;
            }
    </style>
    
	<link href='css/table.css' rel='stylesheet' type='text/css' />
	<table id="headTable" class='table1' cellpadding='0' cellspacing='0' width='100%'>
		<tr class='tr1'>
			<td class='inputth1'>活动名称:</td>
			<td class='inputtd1'><input value='' id='attreventname' type='text' style='width:140px;'>
			</td>
				<td class='inputth1' style='width:100px;'>角色(岗位)选择:</td>
		
			    <!--
			    <input value='' id='S_AUDIT_ROLE' type='text' style='width:140px;' selcode='1501399352233' class='ylselect' seltype='data' dataid='1401297759444' nodecode='SROLECODE' nodename='SROLENAME'>
	            -->
	        	<td class='inputtd1'>
			   
			    <input  id='NO_AUDIT_SHOW' type='text' style='width:140px;'  onclick="javaScript:miniWin('选择','','View?SPAGECODE=1501577842420&flow=select',1000,630,'','');"  readonly="readonly">
				<input  id='S_AUDIT_ROLE' type='hidden' style='width:140px;'  readonly="readonly">
				 <!--
							    			    <input value='' id='S_AUDIT_ROLE' type='text' style='width:140px;' selcode='1501399352233' class='ylselect' seltype='data' dataid='1401297759444' nodecode='SROLECODE' nodename='SROLENAME'>
-->
			
			</td>
		</tr>

			<tr class='tr1'>
			<td class='inputth1'>描述:</td>
			<td class='inputtd1'><input value='' id='S_AUDIT_DESC' type='text' class="tableinputV">
			</td>
				<td class='inputth1' style='width:100px;'>通知消息:</td>
			<td class='inputtd1'>
				
			    <input type="text" id="S_AUDIT_TZXX"  ruleTip="通知消息"  nodepcode="" selcode='1502935066353' style="width:100%;height:25px"  class='ylselect'  seltype='datatree'  nodecode='T_XXGL__S_ID' nodename='T_XXGL__S_MBMC' dataid='1502073646538'/>
			</td>
		</tr>

		<tr class='tr1'>
			<td class='inputth1' style='width:100px;'>
			    三权角色选择:
			</td>
	        <td class='inputtd1'>
                <select id='S_AUDIT_SQRY' style="width: 140px;">
                        <option value=""></option>
                    <ylt.for dataId="1509351562856">
                        <option value="$value">$value</option>
                    </ylt.for>
                </select>
                常量<input type="radio" name="sqryCBL" att="CL" onclick="radioClickCB(this);" />
                变量<input type="radio" name="sqryCBL" att="BL" onclick="radioClickCB(this);" />
			</td>
			<td class='inputth1' style='width:100px;'>
			    属性选择:
			</td>
	        <td class='inputtd1'>
	            
	            
                <select id="NO_CL"  style="width: 140px;display:none;">
                    <option value="" ></option>
                    <option value="KPR" >开票人</option>
                    <option value="QFR" >签发人</option>
                    <option value="XKR" >许可人</option>
                    <option value="QT" >其他</option>
                </select>
                
                
                <select id="NO_BL" style="width: 140px;display:none;">
                    <option value=""></option>
                </select>
                
                <input id='S_AUDIT_SQRYATTR' type="hidden" />
			</td>
		</tr>
		
		<tr class='tr1'>
			<td class='inputth1'  style="visibility:hidden">
			    
			</td>
			<td class='inputtd1'  style="visibility:hidden">
			    
			</td>
			<td class='inputth1' style='width:100px;'>
			    属性补充:
			</td>
	        <td class='inputtd1'>
			    <input type="text" id="NO_CL2" style="width: 140px;display:none;"/>
			    <select id="NO_BL2" style="width: 140px;display:none;">
                    <option value=""></option>
                </select>
			</td>
		</tr>
		
		<tr class='tr1'>
			<td class='inputth1' style='width:100px;'>
			    包名称:
			</td>
			<td class='inputtd1'>
			    <input name="S_AUDIT_PAGENAME" id='S_AUDIT_PAGENAME' type='text' style='width:140px;'>
			</td>
			<td class='inputth1' style='width:100px;'>
			    类名称:
			</td>
	        <td class='inputtd1'>
			    <input name="S_AUDIT_CLASSNAME" id='S_AUDIT_CLASSNAME' type='text' style='width:140px;' >
			</td>
		</tr>
		<!--"S_AUDIT_PAGENAME","S_AUDIT_CLASSNAME"-->
		
		
	
	    	            <input value='' id='S_AUDIT_TABLECONTROL' type='hidden' style='width:140px;'>

		</table>
		<div id="fg" toShow="yes"  class="blackTable" >

	    </div>
	    	<div style="width:100%;color:#000;">当前用户:{user},当前用户角色:{role},当前用户部门:{branchid},当前时间:{date},其他请填写默认值</div>
			  <div id="flowSpan">
        </div>
			  
			  <ylt.fun fun="TheSelectTable"/>
	
	
	
		<table class='table1' cellpadding='0' cellspacing='0' width='100%'>
		<tr>
			<td colspan='2' align='right' class='bttformoparea'>
				<table>
					<tr>
						<td>
							<a id="submitToObj"  href="javascript:getAttr();"  class="button green" ><span><div
									class='bttn_panel'
									style='background-image:url(images/eve/qd.png);'>确定</div> </span> </a>
						</td>
						<td width='50px'>&#160;</td>
					</tr>

				</table>
			</td>
		</tr>
	</table>
    <script>
        <ylt.v message="gs_upl_kc">
            var gs_upl_kc="";
        $value
            var gs_upl_kc="$value";
        </ylt.v>
        var liuchenpeizhi=false;
    </script>
	<script>
        var objParent=parent.getOpenPage(gs_upl_kc);
        var objParentFlow=objParent.ylt.flow;

        var array_end = objParentFlow.arrStrAttrIds;
        var iFieldCount=array_end.length;
  
        var NO_BLElement=document.getElementById('NO_BL');
        
        function trim(str){ 
　　        return str.replace(/(^\s*)|(\s*$)/g, "");
　　    }

    	function getAttr() {
            sanquanInit();
			var objAttr = new Object();
			for(var i = 0;i<iFieldCount;i++ ){
			    var objInputElement=document.getElementById(array_end[i]);
			    if(objInputElement!=null){
				    objAttr[array_end[i]] = objInputElement.value;
			    }
		
	        }
	        
	        objAttr['S_AUDIT_TABLECONTROL'] =tableColReturn();
	        objAttr['attreventname'] = document.getElementById('attreventname').value;
		    objParentFlow.changeAttr(objAttr);
		    parent.closeWinById(gs_upl_kc);
		}
		
		
    	function initValue(){
	   document.getElementById('attreventname').value = objParentFlow.objCurSelGraph.data("text");
	    for(var i = 0;i<iFieldCount;i++ ){
			if(document.getElementById(array_end[i])!=null){
			document.getElementById(array_end[i]).value=objParentFlow.objCurSelGraph.data("attr_"+array_end[i])==undefined?"":objParentFlow.objCurSelGraph.data("attr_"+array_end[i]);
			
				
			}
		
	    }
	}
	initValue();
	var arrName = [];
		var arrCod = [];
		var flowSpan = $("flowSpan");
		var Element = null;
		var strSplitTableContRol = TABLECONTROL.split("`");
		var strSplitTableContRolLength = strSplitTableContRol.length;
		for(var i = 0; i < strSplitTableContRolLength; i++) {
		    try{
    			var strSplitTableContRolArr = strSplitTableContRol[i].split("$");
    			var strSplitTableContRolArr = strSplitTableContRol[i].split("$");
    			var tableId=strSplitTableContRolArr[0];
    		    var tableName=strSplitTableContRolArr[1];
    		    var tableJur=strSplitTableContRolArr[2];
    		    var tableCod=strSplitTableContRolArr[3];
    			Element = document.createElement("span");
    			Element.setAttribute("onclick","showTable1(this,'"+tableId+"')");
    			Element.setAttribute("class","noneSpan");
    			Element.innerHTML = "<input style='vertical-align:middle;' type='checkbox' "+(tableJur=="true"?"checked":"")+" id='"+tableId+"#Jur' />"+tableName;
    			arrName.push(tableId);
    			arrCod.push(tableCod);
    			var TABLECONTROL_Value = document.getElementById("S_AUDIT_TABLECONTROL").value;
    			tablejong(tableId,tableCod);
    			flowSpan.appendChild(Element);
		    }catch(e){
		        
		    }
		}
        var TABLECONTROL_Value = document.getElementById("S_AUDIT_TABLECONTROL").value;

        
        var strCol=""; 
		var spanObj=null;
		function showTable1(_obj,_str){
		    if(strCol!=""){
		        $(strCol+"#tableCol1").style.display="none";
			    $(strCol+"#tableCol2").style.display="none";
			    spanObj.className = "noneSpan";
		    }
			$(_str+"#tableCol1").style.display="";
			$(_str+"#tableCol2").style.display="";
			_obj.className = "blockSpan";
			spanObj=_obj;
			strCol=_str;
		}
			function tableColReturn(){
			var strReturn = "";
			var strSplitReturn = "";
			var arrNameLength = arrName.length;
			for(var i=0;i<arrNameLength;i++){
			    strReturn +=strSplitReturn;
			    strReturn +=arrName[i]+"$";
			    strReturn +=$(arrName[i]+"#Jur").checked+"$";
			    var CodRrrValue=arrCod[i].split("|");
			    var CodRrrValueLength=CodRrrValue.length;
			    var strSplit = "";
			    for(var j = 0 ;j<CodRrrValueLength;j++){
			        var Code = $(arrName[i] + "$" + CodRrrValue[j].split(",")[1] + "#Code").innerHTML;
					var show = $(arrName[i] + "$" + CodRrrValue[j].split(",")[1] + "#show").checked;
					var edit = $(arrName[i] + "$" + CodRrrValue[j].split(",")[1] + "#edit").checked;
					var required = $(arrName[i] + "$" + CodRrrValue[j].split(",")[1] + "#required").checked;
					var cl = $(arrName[i] + "$" + CodRrrValue[j].split(",")[1] + "#cl").value;
					if(show == true && edit == false && cl == "") {
						continue;
					}
					strReturn += strSplit;

					strReturn += Code + ",";
					strReturn += show + ",";
					strReturn += edit + ",";
					strReturn += required + ",";
					strReturn += trim(cl);
					strSplit = "|";
			    }
			    strSplitReturn="`";
			}
			return strReturn;	
		}
		function tablejong(tableName,tableCod) {
			var tableAttr = tableCod.split("|");
			var index = tableAttr.length;
			var toLeftOrRight = Math.ceil(index / 2);
			var tableCol = document.getElementById(tableName+"#tableCol1");
			var tableCol2 = document.getElementById(tableName+"#tableCol2");
			var NO_BL = document.getElementById('NO_BL');
			for(var i = 0; i < index; i++) {
				var tableColAttr = tableAttr[i].split(",");
				var tempID=tableName+"$"+tableColAttr[1];
				var optionArr=document.createElement('option');
				/*三权测试*/
				optionArr.innerHTML=tableColAttr[0];
				optionArr.value=tableColAttr[1];
				NO_BL.appendChild(optionArr);
				
				var tempTr = "";
				tempTr = "<tr class='tr1'><td id= '" + tempID + "#Name'>" + tableColAttr[0] + "</td><td style='display:none;' id='" + tempID + "#Code'>" + tableColAttr[1] + "</td><td><input id='" + tempID + "#show' " + (tableColAttr[2] == 'true' ? 'checked' : '') + "  type='checkbox' /></td><td><input id='" + tempID + "#edit' " + (tableColAttr[3] == 'true' ? 'checked' : '') + "  type='checkbox' /></td><td><input onclick='requiredCod(this);' id='" + tempID + "#required' " + (tableColAttr[4] == 'true' ? 'checked' : '') + "  type='checkbox' /></td><td><input id='" + tempID + "#cl' type='text' style='width:95%'  value='" + tableColAttr[5] + "'  /></td></tr>";
				if(i < toLeftOrRight) {
    				tableCol.innerHTML += tempTr;
    			} else {
    				tableCol2.innerHTML += tempTr;
    			}
			}
		}
		 document.getElementById("fg").onclick = function() {

			if(this.getAttribute("toShow") == "yes") {
				document.getElementById("headTable").style.display = "none";
				this.className = "noneTable";
				this.setAttribute("toShow", "no")
			} else {
				document.getElementById("headTable").style.display = "";
				this.className = "blackTable";
				this.setAttribute("toShow", "yes")
			}
		};
			var spanTabArr = document.getElementById("flowSpan").getElementsByTagName("span");
		if(spanTabArr.length>0){
		    spanTabArr[0].click();
		}

		if(TABLECONTROL_Value!=null&&TABLECONTROL_Value!=""){
            var allTableJurCod = TABLECONTROL_Value.split("`");
			var allTableJurCodLength = allTableJurCod.length;
			for(var i = 0; i < allTableJurCodLength; i++) {
				var tableJurCod = allTableJurCod[i].split("$");
				var tableId = tableJurCod[0];
				if(arrName.indexOf(tableId) == -1) {
					$("S_AUDIT_TABLECONTROL").value = "";
					continue;
				}
				var tableJur = tableJurCod[1];
				var tableCon = tableJurCod[2];
				var tableConArr = tableCon.split("|");
				var tableConLength = tableConArr.length;
				$(tableId + "#Jur").checked = (tableJur == "true" ? true : false);
				if(tableCon === "") {
					continue;
				}
				for(var z = 0; z < tableConLength; z++) {
					var temp = tableConArr[z].split(",");
					$(tableId + "$" + temp[0] + "#show").checked = (temp[1] == "true" ? true : false);
					$(tableId + "$" + temp[0] + "#edit").checked = (temp[2] == "true" ? true : false);
					if(temp[3] == "true"||temp[3] == "false"){
					    $(tableId + "$" + temp[0] + "#required").checked = (temp[3] == "true" ? true : false);
					    $(tableId + "$" + temp[0] + "#cl").value = temp[4];
					}else{
					    $(tableId + "$" + temp[0] + "#cl").value = temp[3];
					    liuchenpeizhi=true;
					}
				}
			}
        }
	</script>
	<script>/*三权*/
	    var radioArreName="";
	    var S_AUDIT_SQRYATTR = $('S_AUDIT_SQRYATTR');
	    var NO_CL = $('NO_CL');
	    var NO_CL2 = $('NO_CL2');
	    var NO_BL = $('NO_BL');
	    var NO_BL2 = $('NO_BL2');
	    NO_BL2.innerHTML=NO_BL.innerHTML;
	    function splitValue(_str,_split,_index){
	        return _str.split(_split)[_index];
	    }
	    function clickRadioElement(_name){
			var radioArr = document.getElementsByName(_name);
			for(i in radioArr){
				if(radioArr[i].checked){
					return radioArr[i];
				}
			}
			return null;
		}
		function oneMidn(_name,_value){
	        var rdio=document.getElementsByName(_name);
            for(var i = 0,j=rdio.length;i<j;i++){
                if(rdio[i].getAttribute("att")==_value){
                    rdio[i].click();
                }
            }
	    }
	    function radioClickCB(_obj){
	        var att=_obj.getAttribute("att");
	        if(radioArreName!=""){
	            $("NO_"+radioArreName).style.display="none";
	            $("NO_"+radioArreName+"2").style.display="none";
	        }
	        radioArreName=att;
	        $("NO_"+att).style.display="";
	        $("NO_"+att).setAttribute("rule","bxtx");
	        $("NO_"+att+"2").style.display="";
	    }
	    function sanquanInit(){
	        var RadioElement=clickRadioElement("sqryCBL");
	        if(RadioElement==null){
	            return true;
	        }
	        var attValue=RadioElement.getAttribute("att");
	        if(attValue=="BL"){
	            S_AUDIT_SQRYATTR.value=attValue+":"+splitValue(NO_BL.value,".",0)+"|"+splitValue(NO_BL.value,".",1)+"|"+splitValue(NO_BL2.value,".",1);
	        }else if(attValue=="CL"){
	            S_AUDIT_SQRYATTR.value=attValue+":"+(NO_CL.value=="QT"?"":NO_CL.value)+NO_CL2.value;
	        }
	    }

        if(S_AUDIT_SQRYATTR.value!=""){
            var ze = S_AUDIT_SQRYATTR.value.substr(0,2);
            var ze2 = S_AUDIT_SQRYATTR.value.substr(3,S_AUDIT_SQRYATTR.value.length);
            oneMidn("sqryCBL",ze);
            if(ze=="CL"){
                
                if(ze2.indexOf("KPR")==0||ze2.indexOf("QFR")==0||ze2.indexOf("XKR")==0){
                    NO_CL.value=ze2;
                }else{
                    NO_CL.value="QT";
                    NO_CL2.value=ze2;
                }
            }else if (ze=="BL"){
                var table = ze2.split("|")[0];
                var cell = ze2.split("|")[1];
                var zhucell = ze2.split("|")[2];
                NO_BL.value=table+"."+cell;
                NO_BL2.value=table+"."+zhucell;
            }
        }
        	if(liuchenpeizhi){
		    alert("当前节点,回写出现错误,请重新保存");
		}
	</script>


